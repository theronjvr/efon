<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Index</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .product-link {
            display: block;
            margin: 10px 0;
            text-decoration: none;
            color: blue;
            position: relative;
        }
        .product-link:hover .product-image {
            display: block;
        }
        .product-image {
            display: none;
            position: absolute;
            top: 0;
            left: 200px;
            width: auto;
            max-height: 300px;
            border: 1px solid #ccc;
            background-color: #fff;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <h1>Efon's Droids Build-A-Droid</h1>
    <div id="productList">Loading...</div>

    <script>
        // Fetch product data from an external XML file
        async function fetchProductData() {
            const response = await fetch('products.xml');
            const text = await response.text();
            const productDoc = new DOMParser().parseFromString(text, "application/xml");
            return Array.from(productDoc.getElementsByTagName("product"));
        }

        // Generate product links with module counts
        async function displayProducts() {
            const productList = document.getElementById("productList");
            const products = await fetchProductData();

            if (products.length === 0) {
                productList.textContent = "No products found.";
                return;
            }

            productList.innerHTML = ""; // Clear loading message

            products.forEach(product => {
                const productId = product.getAttribute("id");
                const productName = product.getElementsByTagName("name")[0].textContent;
                const productImage = product.getElementsByTagName("image")[0].textContent;

                // Parse module counts
                const maxModules = product.getElementsByTagName("maxModules")[0].children;
                const moduleCounts = { C: 0, S: 0, H: 0, A: 0, P: 0 };
                Array.from(maxModules).forEach(slot => {
                    const type = slot.tagName[0]; // Use first letter of tag name
                    moduleCounts[type] = parseInt(slot.textContent);
                });

                // Create link for product
                const link = document.createElement("a");
                link.href = `selector.html?productId=${productId}`;
                link.className = "product-link";
                link.textContent = `${productName} - C:${moduleCounts.C}, S:${moduleCounts.S}, H:${moduleCounts.H}, A:${moduleCounts.A}, P:${moduleCounts.P}`;

                // Add hover image
                const image = document.createElement("img");
                image.src = productImage;
                image.alt = productName;
                image.className = "product-image";

                link.appendChild(image);
                productList.appendChild(link);
            });
        }

        displayProducts();
    </script>
</body>
</html>
