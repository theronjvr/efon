<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Index</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="https://theronjvr.github.io/efon/icon.png">
    <style>
        /* Page-Specific CSS */
        #header-id {
            background-color: #333;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .category-section {
            margin-bottom: 40px;
        }

        .category-section h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 20px;
            justify-items: center;
        }

        .product-card {
            text-align: center;
        }

        .product-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            border: 1px solid #ccc;
            padding: 5px;
            background-color: #fff;
            border-radius: 5px;
            transition: transform 0.2s;
        }

        .product-image:hover {
            transform: scale(1.1);
        }

        .product-name {
            font-weight: bold;
            margin: 10px 0 5px;
        }

        .product-stats {
            font-size: 0.9em;
            color: #555;
        }
    </style>
</head>
<body>
    <header id="header-id">
    </header>

    <div class="content">
        <h1>Efon's Build-A-Droid</h1>
        <p>Select a droid</p>

        <div id="combatProducts" class="category-section">
            <h3>Combat Droids</h3>
            <div id="combatList" class="product-grid">Loading...</div>
        </div>

        <div id="utilityProducts" class="category-section">
            <h3>Utility Droids</h3>
            <div id="utilityList" class="product-grid">Loading...</div>
        </div>
    </div>

    <script>
        // Fetch product data from an external XML file
        async function fetchProductData() {
            const response = await fetch('products.xml');
            const text = await response.text();
            const productDoc = new DOMParser().parseFromString(text, "application/xml");
            return Array.from(productDoc.getElementsByTagName("product"));
        }

        // Generate product cards grouped by type
        async function displayProducts() {
            const combatList = document.getElementById("combatList");
            const utilityList = document.getElementById("utilityList");
            const products = await fetchProductData();

            if (products.length === 0) {
                combatList.textContent = "No combat products found.";
                utilityList.textContent = "No utility products found.";
                return;
            }

            // Clear loading messages
            combatList.innerHTML = "";
            utilityList.innerHTML = "";

            products.forEach(product => {
                const productId = product.getAttribute("id");
                const productName = product.getElementsByTagName("name")[0].textContent;
                const productImage = product.getElementsByTagName("image")[0].textContent;
                const productType = product.getElementsByTagName("type")[0].textContent;

                // Parse module counts
                const maxModules = product.getElementsByTagName("maxModules")[0].children;
                const moduleCounts = { C: 0, S: 0, H: 0, A: 0, P: 0 };
                Array.from(maxModules).forEach(slot => {
                    const type = slot.tagName[0]; // Use first letter of tag name
                    moduleCounts[type] = parseInt(slot.textContent);
                });

                // Create product card
                const card = document.createElement("div");
                card.className = "product-card";

                const image = document.createElement("img");
                image.src = productImage;
                image.alt = productName;
                image.className = "product-image";

                const name = document.createElement("div");
                name.className = "product-name";
                name.textContent = productName;

                const stats = document.createElement("div");
                stats.className = "product-stats";
                stats.textContent = `C:${moduleCounts.C}, S:${moduleCounts.S}, H:${moduleCounts.H}, A:${moduleCounts.A}, P:${moduleCounts.P}`;

                const link = document.createElement("a");
                link.href = `selector.html?productId=${productId}`;
                link.appendChild(image);
                link.appendChild(name);
                link.appendChild(stats);

                card.appendChild(link);

                // Append card to the appropriate list
                if (productType === "Combat") {
                    combatList.appendChild(card);
                } else if (productType === "Utility") {
                    utilityList.appendChild(card);
                }
            });
        }

        displayProducts();
    </script>
</body>
</html>
