<!DOCTYPE html>
<!-- saved from url=(0067)https://theronjvr.github.io/efon/selector/selector.html?productId=2 -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Selector</title>
    <style>
        .product-image {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
        }
        .module-container {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        .module-label {
            display: inline-block;
            width: 150px;
        }
        .module-description {
            margin-left: 20px;
            font-style: italic;
            color: gray;
        }
        #priceContainer {
            margin-top: 20px;
        }
        #summaryContainer {
            margin-top: 20px;
        }
        #summaryField {
            width: 100%;
            height: 100px;
        }
    </style>
</head>
<body>
    <h1 id="productName">Probot Advanced II</h1>
    <img id="productImage" class="product-image" alt="Product Image" src="./selector_files/Probot-droid.png">
    <div id="moduleSelectors"><div class="module-container"><span class="module-label">Combat Slot 1</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 2</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 3</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 4</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 5</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 6</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 7</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 8</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Combat Slot 9</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Hybrid Slot 1</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option><option value="Auto Repair">Auto Repair</option><option value="Crafting - Clothing">Crafting - Clothing</option><option value="Crafting - Foods">Crafting - Foods</option><option value="Crafting - Ship Components">Crafting - Ship Components</option><option value="Crafting - Structures">Crafting - Structures</option><option value="Crafting - Weapons">Crafting - Weapons</option><option value="Creature Harvest">Creature Harvest</option><option value="Detonation Module">Detonation Module</option><option value="Data/Astromech 1">Data/Astromech 1</option><option value="Data/Astromech 2">Data/Astromech 2</option><option value="Data/Astromech 3">Data/Astromech 3</option><option value="Data/Astromech 4">Data/Astromech 4</option><option value="Data/Astromech 5">Data/Astromech 5</option><option value="Data/Astromech 6">Data/Astromech 6</option><option value="Effect - Avian">Effect - Avian</option><option value="Effect - Confetti">Effect - Confetti</option><option value="Effect - Dancing Jawa">Effect - Dancing Jawa</option><option value="Effect - Electric Fog">Effect - Electric Fog</option><option value="Effect - Foam">Effect - Foam</option><option value="Effect - Mind Bloom">Effect - Mind Bloom</option><option value="Hand Sampling (Mining)">Hand Sampling (Mining)</option><option value="Item Storage MAX">Item Storage MAX</option><option value="Merchant Barker">Merchant Barker</option><option value="Playback">Playback</option><option value="Structure Maintenance MAX">Structure Maintenance MAX</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Hybrid Slot 2</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option><option value="Auto Repair">Auto Repair</option><option value="Crafting - Clothing">Crafting - Clothing</option><option value="Crafting - Foods">Crafting - Foods</option><option value="Crafting - Ship Components">Crafting - Ship Components</option><option value="Crafting - Structures">Crafting - Structures</option><option value="Crafting - Weapons">Crafting - Weapons</option><option value="Creature Harvest">Creature Harvest</option><option value="Detonation Module">Detonation Module</option><option value="Data/Astromech 1">Data/Astromech 1</option><option value="Data/Astromech 2">Data/Astromech 2</option><option value="Data/Astromech 3">Data/Astromech 3</option><option value="Data/Astromech 4">Data/Astromech 4</option><option value="Data/Astromech 5">Data/Astromech 5</option><option value="Data/Astromech 6">Data/Astromech 6</option><option value="Effect - Avian">Effect - Avian</option><option value="Effect - Confetti">Effect - Confetti</option><option value="Effect - Dancing Jawa">Effect - Dancing Jawa</option><option value="Effect - Electric Fog">Effect - Electric Fog</option><option value="Effect - Foam">Effect - Foam</option><option value="Effect - Mind Bloom">Effect - Mind Bloom</option><option value="Hand Sampling (Mining)">Hand Sampling (Mining)</option><option value="Item Storage MAX">Item Storage MAX</option><option value="Merchant Barker">Merchant Barker</option><option value="Playback">Playback</option><option value="Structure Maintenance MAX">Structure Maintenance MAX</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Hybrid Slot 3</span><select><option value="none">(none)</option><option value="Combat">Combat</option><option value="Combat - Droideka Shield">Combat - Droideka Shield</option><option value="Combat - Electric Shocker">Combat - Electric Shocker</option><option value="Combat - Flame Jet">Combat - Flame Jet</option><option value="Combat - Rapid Discharge Batteries">Combat - Rapid Discharge Batteries</option><option value="Combat - Regenerative Plating">Combat - Regenerative Plating</option><option value="Combat - Torture Panel">Combat - Torture Panel</option><option value="Auto Repair">Auto Repair</option><option value="Crafting - Clothing">Crafting - Clothing</option><option value="Crafting - Foods">Crafting - Foods</option><option value="Crafting - Ship Components">Crafting - Ship Components</option><option value="Crafting - Structures">Crafting - Structures</option><option value="Crafting - Weapons">Crafting - Weapons</option><option value="Creature Harvest">Creature Harvest</option><option value="Detonation Module">Detonation Module</option><option value="Data/Astromech 1">Data/Astromech 1</option><option value="Data/Astromech 2">Data/Astromech 2</option><option value="Data/Astromech 3">Data/Astromech 3</option><option value="Data/Astromech 4">Data/Astromech 4</option><option value="Data/Astromech 5">Data/Astromech 5</option><option value="Data/Astromech 6">Data/Astromech 6</option><option value="Effect - Avian">Effect - Avian</option><option value="Effect - Confetti">Effect - Confetti</option><option value="Effect - Dancing Jawa">Effect - Dancing Jawa</option><option value="Effect - Electric Fog">Effect - Electric Fog</option><option value="Effect - Foam">Effect - Foam</option><option value="Effect - Mind Bloom">Effect - Mind Bloom</option><option value="Hand Sampling (Mining)">Hand Sampling (Mining)</option><option value="Item Storage MAX">Item Storage MAX</option><option value="Merchant Barker">Merchant Barker</option><option value="Playback">Playback</option><option value="Structure Maintenance MAX">Structure Maintenance MAX</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Armor Slot 1</span><select><option value="none">(none)</option><option value="Max Armor">Max Armor</option><option value="No Armor">No Armor</option></select><span class="module-description">Select a module</span></div><div class="module-container"><span class="module-label">Armor Slot 2</span><select><option value="none">(none)</option><option value="Max Armor">Max Armor</option><option value="No Armor">No Armor</option></select><span class="module-description">Select a module</span></div></div>
    <div id="priceContainer">
        <h2>Total Price: <span id="totalPrice">30,000</span> Republic Credits</h2>
    </div>
    <div id="summaryContainer">
        <h3>Selection Summary</h3>
        <textarea id="summaryField" readonly=""></textarea>
    </div>

    <script>
        // Declare global object to store module prices
        let modulePrices = {};
        let basePrice = 0;

        // Fetch product data from an external XML file
        async function fetchProductData() {
            const response = await fetch('products.xml');
            const text = await response.text();
            const productDoc = new DOMParser().parseFromString(text, "application/xml");
            return Array.from(productDoc.getElementsByTagName("product"));
        }

        // Fetch module data from an external XML file
        async function fetchModules() {
            const response = await fetch('modules.xml');
            const text = await response.text();
            const moduleDoc = new DOMParser().parseFromString(text, "application/xml");
            const moduleTypes = moduleDoc.getElementsByTagName("type");
            const moduleMap = {};

            Array.from(moduleTypes).forEach(type => {
                const id = type.getAttribute("id");
                const options = Array.from(type.getElementsByTagName("option")).map(opt => ({
                    id: opt.textContent,
                    description: opt.getAttribute("description"),
                    price: parseFloat(opt.getAttribute("price"))
                }));
                moduleMap[id] = options;
            });

            return moduleMap;
        }

        // Get product by ID
        function getProductById(id, products) {
            return products.find(product => product.getAttribute("id") === id);
        }

        // Create module selector
        function createModuleSelector(labelText, type, moduleMap, selectedModules) {
            const container = document.createElement("div");
            container.className = "module-container";

            const label = document.createElement("span");
            label.className = "module-label";
            label.textContent = labelText;

            const select = document.createElement("select");
            const description = document.createElement("span");
            description.className = "module-description";
            description.textContent = "Select a module";

            // Add "(none)" option with price 0
            const noneOption = document.createElement("option");
            noneOption.value = "none";
            noneOption.textContent = "(none)";
            select.appendChild(noneOption);

            // If module type is Hybrid, include Combat and Service options
            if (type === 'Hybrid') {
                const combatOptions = moduleMap["Combat"] || [];  // Ensure Combat exists
                const serviceOptions = moduleMap["Service"] || [];  // Ensure Service exists

                // Add Combat modules
                combatOptions.forEach(option => {
                    const opt = document.createElement("option");
                    opt.value = option.id;
                    opt.textContent = option.id;
                    select.appendChild(opt);
                    modulePrices[option.id] = option.price;  // Store module price
                });

                // Add Service modules
                serviceOptions.forEach(option => {
                    const opt = document.createElement("option");
                    opt.value = option.id;
                    opt.textContent = option.id;
                    select.appendChild(opt);
                    modulePrices[option.id] = option.price;  // Store module price
                });
            } else {
                // Add regular module options
                const options = moduleMap[type] || [];
                options.forEach(option => {
                    const opt = document.createElement("option");
                    opt.value = option.id;
                    opt.textContent = option.id;
                    select.appendChild(opt);
                    modulePrices[option.id] = option.price; // Store module price
                });
                console.log(`Creating selector for: ${labelText}, Type: ${type}`, moduleMap[type]);}

                select.addEventListener("change", () => {
    const selectedValue = select.value;

    if (selectedValue === "none") {
        description.textContent = "(none)";
        selectedPrice = 0;
    } else {
        const selectedOption =
            type === "Hybrid"
                ? (moduleMap["Combat"] || []).find(opt => opt.id === selectedValue) ||
                  (moduleMap["Service"] || []).find(opt => opt.id === selectedValue)
                : (moduleMap[type] || []).find(opt => opt.id === selectedValue);

        description.textContent = selectedOption?.description || "Select a module";
        selectedPrice = selectedOption?.price || 0;
    }

    // Update selected modules
    const currentIndex = selectedModules.findIndex(item => item.label === labelText);
    if (currentIndex >= 0) {
        selectedModules[currentIndex] = { label: labelText, value: selectedValue };
    } else {
        selectedModules.push({ label: labelText, value: selectedValue });
    }

    // Update price and summary
    updatePrice(selectedModules);
    updateSummary(selectedModules);
});


            container.appendChild(label);
            container.appendChild(select);
            container.appendChild(description);

            return container;
        }

        // Update total price
        function updatePrice(selectedModules) {
            const moduleTotal = selectedModules.reduce((total, module) => {
                return module.value !== "none" ? total + (modulePrices[module.value] || 0) : total;
            }, 0);
            const totalPrice = basePrice + moduleTotal;

            // Format price with commas and no decimals
            const formattedPrice = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(totalPrice);

            document.getElementById("totalPrice").textContent = formattedPrice;
        }

        // Update summary
        const summaryField = document.getElementById("summaryField");
        function updateSummary(selectedModules) {
    // Filter out "none" selections
    const filteredModules = selectedModules.filter(module => module.value !== "none");

    // Group modules by their type or description
    const moduleCounts = {};
    filteredModules.forEach(module => {
        const key = module.value; // Use the module value (ID) as the key
        if (!moduleCounts[key]) {
            moduleCounts[key] = { count: 0, label: module.value };
        }
        moduleCounts[key].count++;
    });

    // Convert grouped data into a readable summary
    const moduleSummary = Object.values(moduleCounts)
        .map(module => `${module.count} ${module.label}${module.count > 1 ? "s" : ""}`)
        .join(", ");

    const productName = document.getElementById("productName").textContent;
    const totalPrice = document.getElementById("totalPrice").textContent;

    summaryField.value = `I would like to purchase a ${productName} with the following modules: ${moduleSummary}. Total Price: ${totalPrice} Republic Credits.`;
}


        // Initialize product and module data
async function initialize() {
    const summaryField = document.getElementById("summaryField");
    const moduleSelectors = document.getElementById("moduleSelectors");
    const totalPriceElement = document.getElementById("totalPrice");

    // Fetch data
    const products = await fetchProductData();
    const moduleMap = await fetchModules();
    console.log("Products Data: ", products);
    console.log("Modules Data: ", moduleMap);

    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get("productId");

    if (!productId) {
        document.getElementById("productName").textContent = "Product not found.";
        return;
    }

    // Set product details
    const product = getProductById(productId, products);
    const name = product.getElementsByTagName("name")[0].textContent;
    const image = product.getElementsByTagName("image")[0].textContent;
    basePrice = parseFloat(product.getElementsByTagName("basePrice")[0].textContent);
    const maxModules = product.getElementsByTagName("maxModules")[0].children;

    document.getElementById("productName").textContent = name;
    document.getElementById("productImage").src = image;

        // Format and display the initial price
        const formattedPrice = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(basePrice);
    totalPriceElement.textContent = formattedPrice;

    const selectedModules = [];

    // Create selectors
    Array.from(maxModules).forEach(moduleSlot => {
    const moduleType = moduleSlot.tagName;
    const maxSlots = parseInt(moduleSlot.textContent);

    if (maxSlots > 0) {
        const options = moduleMap[moduleType];
        for (let i = 0; i < maxSlots; i++) {
            const moduleDiv = createModuleSelector(
                `${moduleType} Slot ${i + 1}`,
                moduleType,
                moduleMap,
                selectedModules
            );
            moduleSelectors.appendChild(moduleDiv);
        }
    }
});
}

initialize();
    </script>

<scribe-shadow id="crxjs-ext" style="position: fixed; width: 0px; height: 0px; top: 0px; left: 0px; z-index: 2147483647; overflow: visible; visibility: visible;"><template shadowrootmode="open"><div id="root-scribe-elem" style="position: fixed; width: 0px; height: 0px; top: 0px; left: 0px; overflow: visible; color: rgb(15, 23, 42);"><div role="region" aria-label="Notifications (F8)" tabindex="-1" style="pointer-events: none;"><ol tabindex="-1" class="fixed bottom-auto right-0 top-0 z-[99999] flex max-h-screen w-[400px] max-w-full p-4"></ol></div></div><link rel="stylesheet" href="chrome-extension://okfkdaglfjjjfefdcppliegebpoegaii/assets/style.css"></template></scribe-shadow></body></html>