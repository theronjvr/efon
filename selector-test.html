<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Efon's Droid - Module Selector</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="https://theronjvr.github.io/efon/icon.png">
    <style>
        .image-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }

        .product-image, .palette-image {
            width: auto;
            height: 300px; /* Default height */
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: transform 0.2s, border-color 0.2s;
        }

        .product-image:hover, .palette-image:hover {
            transform: scale(1.05);
            border-color: #444;
        }

        .color-inputs {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .overlay img {
            max-width: 90%;
            max-height: 90%;
        }

        .overlay-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <a href="index.html"><img src="https://theronjvr.github.io/efon/images/title.png" alt="Efon's Droids"></a>
    </header>
    <div class="content">
        <h2 id="productName">Loading...</h2>
        <div class="image-container">
            <img id="productImage" class="product-image" alt="Product Image">
            <img id="paletteImage" class="palette-image" alt="Palette">
        </div>
        <div id="moduleSelectors"></div>
        <div class="color-inputs" id="colorInputs"></div>
      <div id="priceContainer">
            <h3>Total Price: <span id="totalPrice">0</span> Republic Credits</h3>
        </div>
         <div id="summaryContainer">
            <h3>Order Summary</h3>
            <textarea id="summaryField" readonly></textarea>
        </div>
    </div>

    <!-- Full-size Image Overlay -->
    <div class="overlay" id="imageOverlay">
        <span class="overlay-close" onclick="closeOverlay()">Ã—</span>
        <img id="overlayImage" alt="Full-size Preview">
    </div>

    <script>
        let colorOptions = 0;

        // Fetch product data
        async function fetchProductData(productId) {
            const response = await fetch('products.xml');
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, "application/xml");
            return Array.from(xml.getElementsByTagName("product"))
                .find(product => product.getAttribute("id") === productId);
        }

        // Display product details
        async function initialize() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get("productId");
            const product = await fetchProductData(productId);

            if (!product) {
                document.getElementById("productName").textContent = "Product not found.";
                return;
            }

            const productName = product.getElementsByTagName("name")[0].textContent;
            const productImage = product.getElementsByTagName("image")[0].textContent;
            const paletteImage = product.getElementsByTagName("palette")[0]?.textContent || "";
            colorOptions = parseInt(product.getElementsByTagName("colorOptions")[0]?.textContent || 0);

            document.getElementById("productName").textContent = productName;
            document.getElementById("productImage").src = productImage;
            document.getElementById("paletteImage").src = paletteImage;

            setupColorInputs();
            updateSummary();
        }

        // Setup color input fields
        function setupColorInputs() {
            const colorInputs = document.getElementById("colorInputs");
            colorInputs.innerHTML = ""; // Clear existing inputs

            if (colorOptions >= 1) {
                const color1 = document.createElement("div");
                color1.textContent = "Color 1:";
                const input1 = document.createElement("input");
                input1.type = "text";
                input1.value = "(Default)";
                input1.oninput = updateSummary;
                color1.appendChild(input1);
                colorInputs.appendChild(color1);
            }

            if (colorOptions === 2) {
                const color2 = document.createElement("div");
                color2.textContent = "Color 2:";
                const input2 = document.createElement("input");
                input2.type = "text";
                input2.value = "(Default)";
                input2.oninput = updateSummary;
                color2.appendChild(input2);
                colorInputs.appendChild(color2);
            }
        }

        // Update summary
        function updateSummary() {
            const summaryField = document.getElementById("summaryField");
            const productName = document.getElementById("productName").textContent;
            const colorInputs = document.querySelectorAll(".color-inputs input");
            const colors = Array.from(colorInputs).map(input => input.value).join(", ");

            summaryField.value = `I would like to purchase a ${productName} with colors: ${colors}. Total Price: ${document.getElementById("totalPrice").textContent} Republic Credits.`;
        }

        // Image overlay
        function openOverlay(src) {
            const overlay = document.getElementById("imageOverlay");
            const overlayImage = document.getElementById("overlayImage");
            overlayImage.src = src;
            overlay.style.display = "flex";
        }

        function closeOverlay() {
            document.getElementById("imageOverlay").style.display = "none";
        }

        // Event listeners for images
        document.getElementById("productImage").onclick = () => openOverlay(document.getElementById("productImage").src);
        document.getElementById("paletteImage").onclick = () => openOverlay(document.getElementById("paletteImage").src);

        initialize();
    </script>
</body>
</html>
